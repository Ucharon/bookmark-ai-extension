# 首次配置API的bug修复

## 任务上下文

在首次配置API信息后，用户需要关闭并重新打开弹窗才能从"请先配置"状态切换到正常使用状态，这影响了用户体验。此外，API调用失败时的错误信息不够明确，不利于用户排查问题。

## 问题分析

1. 在SettingsPanel中保存设置后，没有通知Popup组件更新其状态
2. Popup组件仅在初始化时检查一次API配置状态，不会响应设置的实时变化
3. 错误提示信息不够具体，对用户不够友好

## 执行计划

1. 修改SettingsPanel组件
   - 添加onSave回调属性
   - 在保存设置成功后调用回调

2. 更新Popup组件
   - 提取API配置检查逻辑到独立函数
   - 添加设置保存成功后的处理函数
   - 在设置保存后重新检查API配置并更新状态

3. 改进错误处理
   - 优化错误信息，提供更详细的中文提示
   - 添加对API请求失败的专门错误处理

## 执行结果

- 用户在配置API后能够立即使用插件功能，无需重启
- 错误提示更加明确，能帮助用户更快地解决问题
- 整体用户体验更加流畅 